rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper functions
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // SECURITY: All writes must go through backend (Firebase Admin SDK)
    // Frontend clients can ONLY read data
    // Backend Admin SDK bypasses these rules
    
    // Users collection - READ ONLY for clients
    match /users/{userId} {
      allow read: if isAuthenticated();
      // All writes must go through backend API
      allow write: if false;
    }
    
    // Teams collection - READ ONLY for clients
    match /teams/{teamId} {
      allow read: if isAuthenticated();
      // All writes must go through backend API
      allow write: if false;
    }
    
    // Groups collection - READ ONLY for clients
    match /groups/{groupId} {
      allow read: if isAuthenticated();
      // All writes must go through backend API
      allow write: if false;
    }
    
    // Levels collection - READ ONLY for clients
    match /levels/{levelId} {
      allow read: if isAuthenticated();
      // All writes must go through backend API
      allow write: if false;
    }
    
    // Submissions collection - READ ONLY for clients
    match /submissions/{submissionId} {
      allow read: if isAuthenticated();
      // All writes must go through backend API
      allow write: if false;
    }
    
    // Hints collection - READ ONLY for clients
    match /hints/{hintId} {
      allow read: if isAuthenticated();
      // All writes must go through backend API
      allow write: if false;
    }
    
    // Leaderboard collection - READ ONLY for clients
    match /leaderboard/{entryId} {
      allow read: if isAuthenticated();
      // All writes must go through backend API
      allow write: if false;
    }
    
    // Config collection - READ ONLY for clients
    match /config/{configId} {
      allow read: if isAuthenticated();
      // All writes must go through backend API
      allow write: if false;
    }
    
    // Announcements collection - READ ONLY for clients
    match /announcements/{announcementId} {
      allow read: if isAuthenticated();
      // All writes must go through backend API
      allow write: if false;
    }
    
    // Manual submissions collection - READ ONLY for clients
    match /manual_submissions/{submissionId} {
      allow read: if isAuthenticated();
      // All writes must go through backend API
      allow write: if false;
    }
    
    // Check-ins collection - READ ONLY for clients
    match /check_ins/{checkInId} {
      allow read: if isAuthenticated();
      // All writes must go through backend API
      allow write: if false;
    }
    
    // Hint usage collection - READ ONLY for clients
    match /hint_usage/{usageId} {
      allow read: if isAuthenticated();
      // All writes must go through backend API
      allow write: if false;
    }
    
    // Event config collection - READ ONLY for clients
    match /event_config/{configId} {
      allow read: if isAuthenticated();
      // All writes must go through backend API
      allow write: if false;
    }
    
    // Level index collection - INTERNAL USE ONLY (backend only)
    // These are used for atomic uniqueness constraints
    match /level_index/{indexId} {
      allow read: if false;
      allow write: if false;
    }
    
    // QR index collection - INTERNAL USE ONLY (backend only)
    // These are used for atomic uniqueness constraints
    match /qr_index/{indexId} {
      allow read: if false;
      allow write: if false;
    }
  }
}

